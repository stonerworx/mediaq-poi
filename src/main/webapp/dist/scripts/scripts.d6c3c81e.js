!function(){"use strict";function a(a,b,c){a.when("/",{templateUrl:"views/main.html",controller:"MainController",controllerAs:"vm"}).when("/about",{templateUrl:"views/about.html",controller:"AboutController",controllerAs:"vm"}).otherwise({redirectTo:"/"}),b.configure({key:"AIzaSyDIZgzM1EkYHEhOJfcjUvm0ovOUczk7v8s",v:"3.17"}),c.debugEnabled(!0)}a.$inject=["$routeProvider","uiGmapGoogleMapApiProvider","$logProvider"],angular.module("mediaqPoi",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","uiGmapgoogle-maps","Showdown"]).config(a)}(),function(){"use strict";function a(a,b,c,d,e){var f=this,g=3e3,h=[];a.then(function(a){f.loading=!0;var i=new a.Map(angular.element(".angular-google-map-container")[0]),j=angular.element(".videoplayer video")[0],k=new a.places.Autocomplete(angular.element("#placesearch")[0]);f.map={control:{},center:{latitude:48.150529,longitude:11.595077},dragging:!1,zoom:15},f.options={mapTypeControl:!1,zoomControl:!0,zoomControlOptions:{style:a.ZoomControlStyle.LARGE,position:a.ControlPosition.LEFT_CENTER},panControl:!1,streetViewControl:!1},f.markers=h,f.videoVisible=!1,f.nearbyPoiMarkers=[],f.visiblePoiMarkers=[],f.markerOptions={animation:a.Animation.DROP},f.activeVideo=new c,f.loading=!1,f.videoPositionMarker={id:"videoPosition",icon:{url:"/images/ignore/position.png",anchor:{x:12.5,y:12.5}},coords:{},control:{}},f.videoPositionView={id:"videoView",icon:{path:"M 0 0 L -35 -100 L 35 -100 z",fillColor:"#3884ff",fillOpacity:.7,scale:1,strokeColor:"#356cde",rotation:90,strokeWeight:1}},f.currentPoiMarkers=[],f.searchRadius={},f.places={autocomplete:"",options:null,results:"",details:""},j.addEventListener("timeupdate",function(){var a=Math.round(j.currentTime);if(f.activeVideo.setSecond(a),f.activeVideo.getVisible()){f.videoPositionMarker.coords=f.activeVideo.getCurrentCoordinates(),f.videoPositionView.icon.rotation=f.activeVideo.getCurrentRotation(),f.currentPoiMarkers=f.activeVideo.getCurrentPoiMarkers();for(var b in f.currentPoiMarkers)f.currentPoiMarkers[b].show=!0}else f.videoPositionMarker={},f.currentPoiMarkers=[];d.$apply()},!1),f.clickMarker=function(a){f.openVideo(a.model.id)},f.closeVideo=function(){j.pause(),f.activeVideo.hide(),f.markers=h,f.activeVideo=new c,f.nearbyPoiMarkers=[],f.visiblePoiMarkers=[],f.videoPositionMarker.coords={},f.videoVisible=!1,f.currentPoiMarkers=[],f.map.zoom=15},f.openVideo=function(a){f.loading=!0,f.markers=[],b.getVideo(a).then(function(a){f.activeVideo=a,f.map.center=f.activeVideo.getCenter(),f.map.zoom=f.activeVideo.getZoomLevel(),f.videoVisible=!0,f.searchRadius.center=f.activeVideo.getCenter();var b=function(a){f.searchRadius.radius=a,a<f.activeVideo.getRadius()?e(function(){b(f.searchRadius.radius+2)},5):e(function(){f.nearbyPoiMarkers=f.activeVideo.getNearbyPoiMarkers(),e(function(){f.nearbyPoiMarkers=[],f.visiblePoiMarkers=f.activeVideo.getVisiblePoiMarkers();for(var a in f.visiblePoiMarkers)f.visiblePoiMarkers[a].show=!0;e(function(){f.searchRadius={center:{latitude:0,longitude:0},radius:0},f.visiblePoiMarkers=[],f.activeVideo.show(),j.play(),f.loading=!1},g)},2/3*g)},1/3*g)};b(1)})},a.event.addListenerOnce(i,"idle",function(){function c(){clearTimeout(g),f.videoVisible||(g=setTimeout(i,1e3))}var e=f.map.control.getGMap();navigator.geolocation.getCurrentPosition(function(a){f.map.center.latitude=a.coords.latitude,f.map.center.longitude=a.coords.longitude,d.$apply(),i()});var g,i=function(){var a={northEast:{latitude:e.getBounds().getNorthEast().lat(),longitude:e.getBounds().getNorthEast().lng()},southWest:{latitude:e.getBounds().getSouthWest().lat(),longitude:e.getBounds().getSouthWest().lng()}};b.getVideos(a).then(function(a){f.loading=!1,angular.forEach(a,function(a){h.push(a.getMarker())})})};a.event.addListener(e,"dragstart",function(){clearTimeout(g)}),a.event.addListener(e,"dragend",c),a.event.addListener(e,"zoom_changed",c),a.event.addListener(k,"place_changed",function(){var a=k.getPlace();a.geometry&&(f.map.center.latitude=a.geometry.location.lat(),f.map.center.longitude=a.geometry.location.lng(),f.map.zoom=15,d.$apply(),i())}),i()})})}angular.module("mediaqPoi").controller("MainController",["uiGmapGoogleMapApi","dataService","VideoModel","$scope","$timeout",a])}(),function(){"use strict";function a(a,b){var c=this;a.get("views/readme.md").then(function(a){c.markdown=b.makeHtml(a.data)})}angular.module("mediaqPoi").controller("AboutController",["$http","$Showdown",a])}(),function(){"use strict";function a(a,b,c,d){function e(e){var f=c.defer();b.info("requesting videos with bounds: NW {"+e.northEast.latitude+", "+e.northEast.longitude+"}. SE {"+e.southWest.latitude+", "+e.southWest.longitude+"}");var h=g+"/videos?action=range_query&bound1_lat="+e.northEast.latitude+"&bound1_lng="+e.northEast.longitude+"&bound2_lat="+e.southWest.latitude+"&bound2_lng="+e.southWest.longitude;return b.debug(h),a(h).get(function(a){void 0!==a.videos?b.info("videos received ("+a.videos.length+"). returning."):b.error("failed to load videos.");var c=[];angular.forEach(a.videos,function(a){c.push(new d(a))}),f.resolve(c)}),f.promise}function f(e){var f=c.defer();return b.info("requesting video "+e+"."),a(g+"/video/"+e).get(function(a){b.info("video received. returning.");var c=new d(a.video);c.setDetails(a),f.resolve(c)}),f.promise}var g="";return"localhost:9000"===window.location.host&&(g="http://localhost:8888"),{getVideos:e,getVideo:f}}angular.module("mediaqPoi").factory("dataService",["$resource","$log","$q","VideoModel",a])}(),function(){"use strict";function a(a,b){function c(c){var d=!1,e=!1,f=0,g=0,h=[],i={},j=0,k=[],l=[],m={},n={},o=0;if(void 0!==c){d=c.key.name;var p=c.trajectory.timeStampedPoints;p.sort(function(a,b){return a.frame<b.frame?-1:a.frame>b.frame?1:0});for(var q in p){var r=p[q];h.push({latitude:r.latitude,longitude:r.longitude}),0===f&&0===g&&(f=r.latitude,g=r.longitude)}}var s=function(a){var b=[];return angular.forEach(a,function(a){b.push(a.getMarker())}),b};this.getId=function(){return d},this.show=function(){e=!0},this.hide=function(){e=!1},this.getVisible=function(){return e},this.getSrc=function(){return d?b.trustAsResourceUrl("http://mediaq.dbs.ifi.lmu.de/MediaQ_MVC_V2/video_content/"+c.fileName):""},this.getLatitude=function(){return f},this.getLongitude=function(){return g},this.getMarker=function(){return{id:this.getId(),latitude:this.getLatitude(),longitude:this.getLongitude(),icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}},this.setDetails=function(b){i=b.center,j=b.searchRange,angular.forEach(b.nearbyPois,function(b){k.push(new a(b))}),angular.forEach(b.visiblePois,function(b){l.push(new a(b))}),angular.forEach(b.timeline,function(b,c){var d=[];angular.forEach(b,function(b){d.push(new a(b))}),m[c]=d}),n=b.posTimeline},this.getCenter=function(){return i},this.getRadius=function(){return j},this.getZoomLevel=function(){return 17},this.getPath=function(){return h},this.getNearbyPois=function(){return k},this.getVisiblePois=function(){return l},this.getTimeline=function(){return m},this.getNearbyPoiMarkers=function(){return s(k)},this.getVisiblePoiMarkers=function(){return s(l)},this.setSecond=function(a){o=parseInt(a)},this.getSecond=function(){return o},this.getCurrentPois=function(){return m[this.getSecond()]},this.getCurrentPoiMarkers=function(){return s(this.getCurrentPois())},this.getCurrentCoordinates=function(){var a=n[this.getSecond()],b=null,c=null;return void 0!==a&&(b=a.latitude,c=a.longitude),{latitude:b,longitude:c}},this.getCurrentRotation=function(){var a=n[this.getSecond()];return void 0!==a?a.thetaX:90}}return c}angular.module("mediaqPoi").factory("VideoModel",["PoiModel","$sce",a])}(),function(){"use strict";function a(){function a(a){var b=a.id,c=a.name,d=a.latitude,e=a.longitude;this.getId=function(){return b},this.getName=function(){return c},this.getLatitude=function(){return d},this.getLongitude=function(){return e},this.getMarker=function(){return{id:this.getId(),icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png",latitude:this.getLatitude(),longitude:this.getLongitude(),options:{title:this.getName()}}}}return a}angular.module("mediaqPoi").factory("PoiModel",[a])}();